<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>在同一个项目中使用Swift 和 Objective-C | Nidom</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="原创翻译,转载注明
原文链接:点击浏览">
<meta property="og:type" content="article">
<meta property="og:title" content="在同一个项目中使用Swift 和 Objective-C">
<meta property="og:url" content="http://nidom.top/article/20140806/use-swift-and-objective-c-in-same-pro/index.html">
<meta property="og:site_name" content="Nidom">
<meta property="og:description" content="原创翻译,转载注明
原文链接:点击浏览">
<meta property="og:image" content="http://nidom.top/images/blog/2014060501.png">
<meta property="og:image" content="http://nidom.top/images/blog/2014060502.png">
<meta property="og:image" content="http://nidom.top/images/blog/2014060503.png">
<meta property="og:image" content="http://nidom.top/images/blog/2014060504.png">
<meta property="og:image" content="http://nidom.top/images/blog/2014060505.png">
<meta property="og:updated_time" content="2015-05-27T05:30:02.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="在同一个项目中使用Swift 和 Objective-C">
<meta name="twitter:description" content="原创翻译,转载注明
原文链接:点击浏览">
  
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="undefined" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Nidom</a></h1>
		</hgroup>

		

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Nidom</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="undefined" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Nidom</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-use-swift-and-objective-c-in-same-pro" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/article/20140806/use-swift-and-objective-c-in-same-pro/" class="article-date">
  	<time datetime="2014-08-06T12:21:39.000Z" itemprop="datePublished">2014-08-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      在同一个项目中使用Swift 和 Objective-C
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>原创翻译,转载注明</p>
<p>原文链接:<a href="https://developer.apple.com/library/prerelease/ios/documentation/Swift/Conceptual/BuildingCocoaApps/MixandMatch.html#//apple_ref/doc/uid/TP40014216-CH10" target="_blank" rel="external">点击浏览</a></p>
<a id="more"></a>
<p>Swift 对Objective-C 的兼容性允许你创建一个包含这两种语言文件的工程。你可以使用名为:“mix and match”的特性来编写包含混合语言代码的app。使用”mix and match”,你可以使用swift的新特性来编写app一部分的功能,同时无缝的和现有的Objective-C（下文简称OC） 代码相融合。</p>
<p>##Mix and Match 概述</p>
<p>OC和swift代码可以在一个工程中共存，无论这个工程原本是OC还是swift工程。你可以轻易的在已有工程文件中添加另一种语言文件。对于创建混合语言的app或framework 来说，这种自然的工作方式和使用单种语言一样直截了当。</p>
<p>写混合语言的流程取决于你是写app还是framework，情况略微不同。对于同一个target要想用两种语言混写，大体的工作流程如下图所绘，具体的内容会在后面的章节描述。</p>
<img src="/images/blog/2014060501.png">  
<p>#在同一个app Target里进行语言代码导入</p>
<p>如果你在写一个混合语言的app，你应该需要在OC中访问swift代码或者从swift中访问OC代码。这个流程会在本章节描述，但仅仅适用于非framework的targets</p>
<p>###把OC代码导入为Swift可用</p>
<p>要在同一个target中导入一些OC文件能为Swift所用，你要依靠”Objective-C bridging header”这个特性来保证OC文件对swift来说是,当点击同意的时候,xcode会在你创建OC文件时同时创建一个头文件，它是根据你工程的product module name加上”-Bridging-Header.h” 拼接而成的。关于product module name的更多信息，后面章节会提到。</p>
<img src="/images/blog/2014060502.png">  
<p>####在同一个 app target中把OC代码导入为Swift</p>
<p>1.在你的Objective-C bridging header文件中，把所有你想暴露给swift 的头文件写在里面,例如:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SWIFT</span><br><span class="line"></span><br><span class="line">let myCell = <span class="function"><span class="title">XYZCustomCell</span><span class="params">()</span></span></span><br><span class="line">myCell<span class="class">.subtitle</span> = <span class="string">"A custom cell"</span></span><br></pre></td></tr></table></figure>
<p>###把Swift代码导入为OC可用</p>
<p>当你想让Swift代码导入为OC可用时，你要依赖Xcode-generated header 这个文件去向OC暴露接口。这个自动生成的文件是一个OC的头文件，其中声明了项目中所有Swift代码的接口。它可以理解为Swift代码的伞头（umbrella header）。这个文件的命名是以你的product module name加上”-Swift.h” 拼接而成的，关于product module name的更多信息，后面章节会提到。</p>
<p>你不需要做任何额外事情来创建这个文件,你只需要在你们的OC代码中import，然后使用就好了。注意,swift代码中使用的所有OC代码也会被generated header中的Swift接口所引用。如果你在SWift代码中使用le 自己的OC代码（译者注:非系统class），那么你必须在OC的.m文件中先导入swift代码中引入OC的OC头文件，然后才可以导入Swift generated header来访问swift代码。（译者注:简单的就是说在Objective-C bridging header中声明的头文件让你可以在swift中访问OC代码，当你在OC中访问swift代码时候，必须在导入generated header之前先导入这些OC头文件。基于这点,要想在预编译pch文件中导入generated header是不现实的，貌似Xcode6以后pch已经被干掉了）</p>
<p>####在同一个app target中将Swift代码导入为OC可用</p>
<p>在同一个target中，将以合适名称命名的Swift代码接口文件（generated header）导入到任何需要用到swift代码的OC.m文件中</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">OBJECTIVE-C</span></span><br><span class="line"></span><br><span class="line"><span class="id">#import</span> “<span class="tag">ProductModuleName-Swift</span><span class="class">.h</span>”</span><br></pre></td></tr></table></figure>
<p>在任何导入这个声明头文件的地方,Swift代码都是可见的。</p>
<img src="/images/blog/2014060503.png">  
<p>####在同一个Framework target里进行语言代码导入</p>
<p>如果你在写一个混合语言的framework，你应该需要在OC中访问swift代码或者从swift中访问OC代码。</p>
<p>###把OC代码导入为Swift可用</p>
<p>要在同一个 framework target中导入一些OC文件能为Swift所用，你需要在 Objective-C umbrella header中导入这些OC的头文件</p>
<p>#####在同一个 framework target中把OC代码导入为Swift 可用</p>
<p>1.在Build Settings-Packaging中，确保 Defines Module setting被设置为YES 2.在你的umbrella header file中，和app target一样，导入你想要暴露给swift的头文件。例如:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">OBJECTIVE-C</span><br><span class="line"></span><br><span class="line"><span class="id">#import</span> <span class="string">"XYZCustomCell.h"</span></span><br><span class="line"><span class="id">#import</span> <span class="string">"XYZCustomView.h"</span></span><br><span class="line"><span class="id">#import</span> <span class="string">"XYZCustomViewController.h"</span></span><br></pre></td></tr></table></figure>
<p>任何一个在 umbrella header 文件中列出来的OC头文件对swift来说都是可见的。在这个target里 OC代码的功能对任何一个swift文件都是自动可用的，不需要导入任何声明。你可以像是使用系统classes一样来使用你自定义的OC代码了。</p>
<p>###把swift代码导入为OC可用</p>
<p>当你要想让Swift代码导入为OC可用，你不需要在 umbrella header 中导入任何东西。和app target类似，你只需要在需要用到swift代码的OC .m文件中导入 Xcode-generated header 文件就好了</p>
<p>####在同一个 framework target中把swift代码导入为OC可用</p>
<p>1.在Build Settings-Packaging中，确保 Defines Module setting被设置为YES 2.在同一个target中，将以合适名称命名的Swift代码接口文件（generated header）导入到任何需要用到的OC .m文件中</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">OBJECTIVE-C</span></span><br><span class="line"></span><br><span class="line"><span class="id">#import</span> “<span class="tag">ProductModuleName-Swift</span><span class="class">.h</span>”</span><br></pre></td></tr></table></figure>
<p>在任何导入这个声明头文件的地方,Swift代码都是可见的。</p>
<img src="/images/blog/2014060504.png">  
<p>#导入外部Frameworks</p>
<p>你可以导入完全使用OC、swift或者混合代码编写的外部frameworks。使用这些frameworks的方法是一样的，无论其是单一语言编写还是混合编写的。当你导入一个外部framework，请确保你的项目Defines Module build setting被设置为Yes。</p>
<p>你可以在不同target中导入一个framework到swift文件中:</p>
<figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SWIFT</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"><span class="keyword">import</span> FrameworkName</span></span><br></pre></td></tr></table></figure>
<p>你可以在不同target中导入一个framework到OC的.m文件中:</p>
<figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OBJECTIVE-C</span><br><span class="line"></span><br><span class="line">@<span class="preprocessor"><span class="keyword">import</span> FrameworkName</span></span><br></pre></td></tr></table></figure>
<img src="/images/blog/2014060505.png">   
<p>###在OC中使用Swift</p>
<p>当你导入swift代码到OC中时候，使用OC的常规语法就可以调用swift的classes了</p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">OBJECTIVE-C</span><br><span class="line"></span><br><span class="line">MySwiftClass *swiftObject = <span class="comment">[<span class="comment">[MySwiftClass alloc]</span> init]</span>;</span><br><span class="line"><span class="comment">[swiftObject swiftMethod]</span>;</span><br></pre></td></tr></table></figure>
<p>一个Swift class 或者 protocol 必须使用@objc的属性标记才可以被OC使用。这个属性告诉编译器这段swift代码可以被OC所访问到。如果你的swift class 是由 Objective-C class 派生的，那么编译器会自动帮你加上@objc标识，获取更多信息请访问:<a href="https://developer.apple.com/library/prerelease/ios/documentation/Swift/Conceptual/BuildingCocoaApps/InteractingWithObjective-CAPIs.html#//apple_ref/doc/uid/TP40014216-CH4-XID_36" target="_blank" rel="external">Swift Type Compatibility</a></p>
<p>当一个class或者protocol 被有@objc 属性标识的时候，你可以访问这个class或者protocol 里面所有的东西，因为它跟OC是兼容的。这里有一些不兼容的特性列表（Swift-only）:</p>
<ul><br><li>Generics</li><br><li>Tuples</li><br><li>Enumerations defined in Swift</li><br><li>Structures defined in Swift</li><br><li>Top-level functions defined in Swift</li><br><li>Global variables defined in Swift</li><br><li>Typealiases defined in Swift</li><br><li>Swift-style variadics</li><br><li>Nested types</li><br><li>Curried functions</li><br></ul>

<p>比如，一个方法有一个generic类型的参数或者返回值是个tuple类型，那它是不能被OC所用的</p>
<p>为了避免循环引用，不要在一个OC的头文件中导入swift。相反，你可以直接在OC的头文件中声明和使用swift class。然而要注意你不能在OC去子类化swift.</p>
<p>###在OC的头文件中引用一个Swift class</p>
<p>直接声明和使用</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">OBJECTIVE-C</span></span><br><span class="line"></span><br><span class="line"><span class="at_rule">@<span class="keyword">class</span> MySwiftClass</span>;</span><br><span class="line"> </span><br><span class="line"><span class="at_rule">@<span class="keyword">interface</span> MyObjcClass : NSObject</span><br><span class="line"> - (MySwiftClass *)returnSwiftObject</span>;</span><br><span class="line"><span class="comment">/* ... */</span></span><br><span class="line"><span class="at_rule">@<span class="keyword">end</span></span></span><br></pre></td></tr></table></figure>
<p>#给 Product Module 命名</p>
<p>Xcode-generated header和 Objective-C bridging header 的命名都是由product module name得来的。默认情况下 product module name和product name是一样的。然而如果你的 product name包含非字母数字字符，例如点(.)，他们会被下划线（_）取代。如果你的product name是以数字开头，那么首字符的数据也会被下划线取代。</p>
<p>你同样可以自定义你的product module name。Xcode会使用你改过的name来命名 bridging 和 generated headers。你可以在build setting里面进行修改。</p>
<p>#问题建议和提醒</p>
<ul><br><li>将你的Swift和OC文件放在同一个集合里，当心命名冲突</li><br><li>如果你开发frameworks，确保Packaging中的Defines Module被设置为YES</li><br><li>如果你使用到Objective-C bridging header，确保，确保项目Swift Compiler – Code Generation中 Objective-C Bridging Header指向了你的Bridging Header文件，这个path指向的是你的Bridging Header文件，而不是它的目录</li><br><li>Xcode使用 product module name而不是 target name来命名bridging header and the generated header.更多信息参考上文”给 Product Module 命名”章节。</li><br><li>一个 swift class 必须由OC class派生或者被@objc标识 才能被OC所获取和使用</li><br><li>Global variables defined in Swift</li><br><li>当你在OC中使用Swift，记住OC并不能读懂swift的一些特性，参考上文中的列表</li><br><li>如果你在SWift代码中使用自己的OC代码，那么你必须在OC的.m文件中先导入swift代码中引入OC的OC头文件，然后才可以导入Swift</li><br></ul>


      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/article/20150504/a-kvc-apply/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          一个解决IB分割线0.5像素问题的好方法
        
      </div>
    </a>
  
  
    <a href="/article/20140324/nshashtable-and-nsmaptable/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">NSHashtable and NSMaptable</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>






</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 Nidom
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    

<script>
	var yiliaConfig = {
		fancybox: undefined,
		mathjax: undefined,
		animate: undefined,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: undefined
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






  </div>
</body>
</html>